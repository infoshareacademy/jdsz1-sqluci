/*
JDSZ1SU-32
(ttest) Czy opóźnienia znacząco różnią się w zależności od regionu?

region liczba op liczba nieop
 */

--

with moje_dane as(
select DISTINCT wylot_kod_regionu region, count(*) over (PARTITION BY wylot_kod_regionu) liczba_wszystkich,
  count(CASE WHEN czas_opoznienia is not null then 1 END) over (PARTITION BY wylot_kod_regionu) liczba_opoznionych,
  count(case when czas_opoznienia is null then 1 end) over (PARTITION BY wylot_kod_regionu) liczba_na_czas
from o_trasy)
  select *, liczba_opoznionych/liczba_wszytskich::numeric proc_opoznionych, liczba_na_czas/liczba_wszytskich::numeric proc_na_czas
  from moje_dane

--pv=18,77% - różnią się

